vizlab: "0.2.2.9003"
info:
  id: vizstorm
  name: Template for storm event visualizations
  date: 2017-10-26
  publish-date: 2017-11-09
  path: /vizstorm
  analytics-id: UA-78530187-1
  description: >-
    Template for storm event visualizations
  thumbnail:
    url:
    width: 250
    height: 250
    alttext:
  required-packages:
    vizlab:
      repo: github
      version: 0.2.2.9003
      name: USGS-VIZLAB/vizlab
      ref: v0.2.2.9003
    dplyr:
      repo: CRAN
      version: 0.5.0
    maps:
      repo: CRAN
      version: 3.2.0
    mapdata: 
      repo: CRAN
      version: 2.2-6
    sf:
      repo: CRAN
      version: 0.5-4
    svglite:
      repo: CRAN 
      version: 1.2.0
    sp:
      repo: CRAN
      version: 1.2.5
    geoknife:
      repo: GRAN
      version: 1.6.0
parameter:
  -
    id: spatial_metadata
    crs: '+init=epsg:2163'
    bbox: [-87, 22, -70, 34]
  -
    id: plot_metadata
    height: 5
    width: 8
    pointsize: 12
  -
    id: animate
    start: "2014-01-01"
    stop: "2014-01-04"
    step: "hour"

fetch:
  -
    id: viewbox_limits
    location: cache/viewbox_limits.rds
    reader: rds
    fetcher: viewbox_limits
    scripts: [scripts/fetch/viewbox_limits.R , scripts/fetch/utils.R]
    depends: ["spatial_metadata", "plot_metadata"]
    comment: sets up the basic view window and projection
  -
    id: state_map_data
    location: cache/state_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: state
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: precip_grid_data
    location: cache/precip_grid_data.rds
    reader: rds
    fetcher: noaa_precip_gdp
    scripts: scripts/fetch/precip_grid_data.R
    depends: 
      sf_stencil: precip_grid
      time_info: animate
  -
    id: county_map_data
    location: cache/county_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: county
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: puerto_rico_map_data
    location: cache/puerto_rico_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: world
      region: "Puerto Rico"
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: islands_map_data
    location: cache/islands_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: mapdata::world2Hires
      regions: "(?!USA)"
      xlim: [275, 300]
      ylim: [16, 30]
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
process:
  -
    id: precip_grid
    location: cache/precip_grid.rds
    reader: rds
    cell_size: 80000
    processor: grid_from_mask
    scripts: [scripts/process/grid_from_mask.R]
    depends: 
      clip_poly: "state_map_data"
  - 
    id: precip_geoms_dataframe
    location: cache/precip_geoms_dataframe.rds
    reader: rds
    processor: sfc_to_svg
    attributes:
      id: '{{ID}}' 
      class: 'precip-cell'
    depends: 
      clip_box: "viewbox_limits"
      spatial_data: "precip_grid"
    scripts: [scripts/process/geom_dataframe.R]
  - 
    id: state_geoms_dataframe
    location: cache/state_geoms_dataframe.rds
    reader: rds
    processor: sfc_to_svg
    attributes:
      id: '{{ID}}-geom' 
    depends: 
      clip_box: "viewbox_limits"
      spatial_data: "state_map_data"
    scripts: [scripts/process/geom_dataframe.R]
  - 
    id: pr_geoms_dataframe
    location: cache/pr_geoms_dataframe.rds
    reader: rds
    processor: sfc_to_svg
    attributes:
      class: island
    depends: 
      clip_box: "viewbox_limits"
      spatial_data: "puerto_rico_map_data"
    scripts: [scripts/process/geom_dataframe.R]
  - 
    id: state_style_dataframe
    location: cache/state_style_dataframe.rds
    reader: rds
    processor: dataframe_to_svg
    attributes:
      class: state
      href: '#{{ID}}-geom'
      id: '{{ID}}'
    depends: 
      clip_box: "viewbox_limits"
      spatial_data: "state_map_data"
    scripts: [scripts/process/geom_dataframe.R]  
  - 
    id: state_mouse_dataframe
    location: cache/state_mouse_dataframe.rds
    reader: rds
    processor: dataframe_to_svg
    attributes:
      onmouseover: hovertext('{{ID}}', evt)
      onmouseout: hovertext(' ')
      class: mouseover
      href: '#{{ID}}-geom'
    depends: 
      clip_box: "viewbox_limits"
      spatial_data: "state_map_data"
    scripts: [scripts/process/geom_dataframe.R] 

visualize:
  -
    id: svg_defs
    location: cache/svg_defs.rds
    visualizer: svg_defs
    reader: rds
    depends: 
      states-geoms: state_geoms_dataframe
    scripts: scripts/something.here.R
  -
    id: svg_map_style
    location: cache/svg_map_style.rds
    visualizer: svg_g
    reader: rds
    depends: 
      pr-style: pr_geoms_dataframe
      states-style: state_style_dataframe
      precip-cells: precip_geoms_dataframe
    scripts: scripts/something.here.R
  -
    id: svg_map_mouse
    location: cache/svg_map_mouse.rds
    visualizer: svg_g
    reader: rds
    depends: 
      states-mouse: state_mouse_dataframe
    scripts: scripts/something.here.R
  -
    id: svg_skeleton
    location: cache/svg_skeleton.svg
    visualizer: svg_skeleton
    depends: 
      map-style: svg_map_style
      map-mouse: svg_map_mouse
      defs: svg_defs
    scripts: ["scripts/visualize/svg_skeleton.R"]
    reader: svg
    mimetype: image/svg+xml
publish:
